name: Deploy to Bluehost (SFTP)

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

concurrency:
  group: bluehost-deploy
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (with LFS)
        uses: actions/checkout@v4
        with:
          lfs: true
          fetch-depth: 0

      # If you build a static site (Vite/Next export), add the build step here
      # and set local_path below to ./dist/* or ./out/*

      - name: Deploy via SFTP (SSH key)
        uses: wlixcc/SFTP-Deploy-Action@v1.2.6
        with:
          server: ${{ secrets.BH_HOST }}             # evanmishler.com or box####.bluehost.com
          username: ${{ secrets.BH_USER }}           # cPanel username
          port: 22
          ssh_private_key: ${{ secrets.BH_PRIVATE_KEY }}
          ssh_passphrase: ${{ secrets.BH_PASSPHRASE }}   # omit this line if your key has NO passphrase
          sftp_only: true
          # change to "./dist/*" or "./out/*" if you build
          local_path: "./*"
          remote_path: ${{ secrets.BH_REMOTE_PATH }} # e.g., /home2/evanmish/public_html/
          sftpArgs: "-o StrictHostKeyChecking=no -o IdentitiesOnly=yes -o ConnectTimeout=10"
          rsyncArgs: "--exclude=.git* --exclude=.github --exclude=node_modules --exclude=.DS_Store"
